<UserControl x:Class="VapourSynthPortable.Controls.LogViewerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:services="clr-namespace:VapourSynthPortable.Services"
             Background="#1E1E1E">

    <UserControl.Resources>
        <!-- Log level colors -->
        <SolidColorBrush x:Key="TraceColor" Color="#808080"/>
        <SolidColorBrush x:Key="DebugColor" Color="#569CD6"/>
        <SolidColorBrush x:Key="InfoColor" Color="#4EC9B0"/>
        <SolidColorBrush x:Key="WarningColor" Color="#DCDCAA"/>
        <SolidColorBrush x:Key="ErrorColor" Color="#F14C4C"/>
        <SolidColorBrush x:Key="CriticalColor" Color="#D16969"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" Background="#2D2D2D" Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Left: Title and filter -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="Output" FontWeight="SemiBold" Foreground="#CCCCCC"
                               VerticalAlignment="Center" Margin="0,0,15,0"/>

                    <!-- Level filter -->
                    <ComboBox x:Name="LevelFilter" Width="100" SelectedIndex="0"
                              SelectionChanged="LevelFilter_SelectionChanged"
                              Background="#3C3C3C" Foreground="#CCCCCC" BorderBrush="#3C3C3C">
                        <ComboBoxItem Content="All Levels"/>
                        <ComboBoxItem Content="Information"/>
                        <ComboBoxItem Content="Warning"/>
                        <ComboBoxItem Content="Error"/>
                    </ComboBox>

                    <!-- Search -->
                    <TextBox x:Name="SearchBox" Width="150" Margin="10,0,0,0"
                             Background="#3C3C3C" Foreground="#CCCCCC" BorderBrush="#3C3C3C"
                             Padding="6,3" TextChanged="SearchBox_TextChanged">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <VisualBrush Stretch="None" AlignmentX="Left">
                                                    <VisualBrush.Visual>
                                                        <TextBlock Text="Search logs..." Foreground="#666666" Margin="6,3"/>
                                                    </VisualBrush.Visual>
                                                </VisualBrush>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                </StackPanel>

                <!-- Center: Stats -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock x:Name="StatsText" Foreground="#666666" FontSize="11"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Right: Actions -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <CheckBox x:Name="AutoScrollCheck" Content="Auto-scroll" IsChecked="True"
                              Foreground="#888888" VerticalAlignment="Center" Margin="0,0,10,0"/>

                    <Button Content="Clear" Click="ClearButton_Click" Padding="8,3"
                            Background="#3C3C3C" Foreground="#CCCCCC" BorderBrush="#3C3C3C"
                            Margin="0,0,5,0"/>

                    <Button Content="Open Logs" Click="OpenLogsButton_Click" Padding="8,3"
                            Background="#3C3C3C" Foreground="#CCCCCC" BorderBrush="#3C3C3C"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Log entries -->
        <ListBox x:Name="LogList" Grid.Row="1"
                 Background="Transparent" BorderThickness="0"
                 VirtualizingStackPanel.IsVirtualizing="True"
                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                 ScrollViewer.CanContentScroll="True"
                 FontFamily="Cascadia Mono,Consolas,Courier New"
                 FontSize="12">
            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                    <Setter Property="Padding" Value="8,2"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="#CCCCCC"/>
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#264F78"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#2A2D2E"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </ListBox.ItemContainerStyle>
            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type services:LogEntry}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="85"/>
                            <ColumnDefinition Width="35"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Timestamp -->
                        <TextBlock Grid.Column="0" Text="{Binding TimestampShort}"
                                   Foreground="#666666" Margin="0,0,8,0"/>

                        <!-- Level -->
                        <TextBlock Grid.Column="1" Text="{Binding LevelShort}" FontWeight="Bold"
                                   Margin="0,0,8,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding LevelShort}" Value="TRC">
                                            <Setter Property="Foreground" Value="#808080"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding LevelShort}" Value="DBG">
                                            <Setter Property="Foreground" Value="#569CD6"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding LevelShort}" Value="INF">
                                            <Setter Property="Foreground" Value="#4EC9B0"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding LevelShort}" Value="WRN">
                                            <Setter Property="Foreground" Value="#DCDCAA"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding LevelShort}" Value="ERR">
                                            <Setter Property="Foreground" Value="#F14C4C"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding LevelShort}" Value="CRT">
                                            <Setter Property="Foreground" Value="#D16969"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Message -->
                        <TextBlock Grid.Column="2" Text="{Binding Message}" TextWrapping="NoWrap"
                                   TextTrimming="CharacterEllipsis"
                                   ToolTip="{Binding FormattedMessage}"/>
                    </Grid>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <!-- Empty state - shown when list is empty -->
        <TextBlock x:Name="EmptyStateText" Grid.Row="1" Text="No log entries"
                   Foreground="#666666" FontStyle="Italic"
                   HorizontalAlignment="Center" VerticalAlignment="Center"
                   Visibility="Collapsed"/>
    </Grid>
</UserControl>
