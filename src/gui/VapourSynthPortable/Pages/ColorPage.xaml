<UserControl x:Class="VapourSynthPortable.Pages.ColorPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:VapourSynthPortable.Controls"
             xmlns:vm="clr-namespace:VapourSynthPortable.ViewModels">

    <UserControl.DataContext>
        <vm:ColorViewModel/>
    </UserControl.DataContext>

    <UserControl.InputBindings>
        <KeyBinding Key="Z" Modifiers="Ctrl" Command="{Binding UndoCommand}"/>
        <KeyBinding Key="Y" Modifiers="Ctrl" Command="{Binding RedoCommand}"/>
        <KeyBinding Key="C" Command="{Binding ToggleCompareCommand}"/>
        <KeyBinding Key="R" Command="{Binding ResetAllCommand}"/>
    </UserControl.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="280"/>
        </Grid.ColumnDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" Grid.ColumnSpan="3" Background="#333" Padding="10,8">
            <DockPanel>
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                    <Button Content="Load Source" Command="{Binding LoadSourceCommand}"
                            Style="{StaticResource SecondaryButton}" Margin="0,0,8,0"/>
                    <Button Content="Import" Command="{Binding ImportGradeCommand}"
                            Style="{StaticResource SecondaryButton}" Margin="0,0,8,0"/>
                    <Button Content="Export" Command="{Binding ExportGradeCommand}"
                            Style="{StaticResource SecondaryButton}" Margin="0,0,20,0"/>

                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="0,0,20,0"/>

                    <Button Content="Undo" Command="{Binding UndoCommand}"
                            IsEnabled="{Binding CanUndo}"
                            Style="{StaticResource SecondaryButton}" Margin="0,0,4,0" Width="50"/>
                    <Button Content="Redo" Command="{Binding RedoCommand}"
                            IsEnabled="{Binding CanRedo}"
                            Style="{StaticResource SecondaryButton}" Margin="0,0,20,0" Width="50"/>

                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="0,0,20,0"/>

                    <Button Content="Reset All" Command="{Binding ResetAllCommand}"
                            Style="{StaticResource SecondaryButton}" Margin="0,0,4,0"/>
                    <Button Content="Reset Wheels" Command="{Binding ResetWheelsCommand}"
                            Style="{StaticResource SecondaryButton}" Margin="0,0,4,0"/>
                    <Button Content="Reset Adjustments" Command="{Binding ResetAdjustmentsCommand}"
                            Style="{StaticResource SecondaryButton}"/>
                </StackPanel>

                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                    <!-- Comparison Controls -->
                    <Border Background="#2A2A2A" CornerRadius="3" Padding="4,2" Margin="0,0,10,0">
                        <StackPanel Orientation="Horizontal">
                            <ToggleButton Content="Compare" IsChecked="{Binding IsCompareMode}"
                                          ToolTip="Toggle comparison (C)"
                                          Style="{StaticResource ToggleButtonStyle}" Width="70"/>
                            <Button Content="Capture" Command="{Binding CaptureOriginalCommand}"
                                    ToolTip="Capture current as original"
                                    Style="{StaticResource SecondaryButton}" Width="60" Margin="4,0,0,0"/>
                            <Button Content="Swap" Command="{Binding SwapGradesCommand}"
                                    ToolTip="Swap original and current"
                                    IsEnabled="{Binding HasOriginalGrade}"
                                    Style="{StaticResource SecondaryButton}" Width="45" Margin="4,0,0,0"/>
                            <Button Content="Revert" Command="{Binding RevertToOriginalCommand}"
                                    ToolTip="Revert to original grade"
                                    IsEnabled="{Binding HasOriginalGrade}"
                                    Style="{StaticResource SecondaryButton}" Width="55" Margin="4,0,0,0"/>
                        </StackPanel>
                    </Border>

                    <ToggleButton Content="Curves" IsChecked="{Binding ShowCurves}"
                                  Style="{StaticResource ToggleButtonStyle}" Width="60" Margin="0,0,10,0"/>
                    <ToggleButton Content="Scopes" IsChecked="{Binding ShowScopes}"
                                  Style="{StaticResource ToggleButtonStyle}" Width="60"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Left Panel: Presets & LUTs -->
        <Border Grid.Row="1" Grid.Column="0" Background="#252526" Margin="10,10,5,5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="180"/>
                </Grid.RowDefinitions>

                <!-- Presets -->
                <Border Grid.Row="0" Margin="0,0,0,5">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Presets" FontSize="13" FontWeight="SemiBold"
                                   Foreground="#F1F1F1" Margin="12,12,12,8"/>

                        <ComboBox Grid.Row="1" ItemsSource="{Binding PresetCategories}"
                                  SelectedItem="{Binding SelectedCategory}"
                                  Margin="12,0,12,8"/>

                        <ListBox Grid.Row="2" ItemsSource="{Binding FilteredPresets}"
                                 SelectedItem="{Binding SelectedPreset}"
                                 Background="Transparent" BorderThickness="0"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Padding="10,6" Margin="4,2" CornerRadius="4"
                                            Background="#2A2A2A" BorderBrush="#3A3A3A" BorderThickness="1">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Name}" Foreground="#DDD" FontSize="11"/>
                                            <TextBlock Text="{Binding Category}" Foreground="#666" FontSize="9"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>

                <GridSplitter Grid.Row="1" Height="4" HorizontalAlignment="Stretch"
                              Background="#333" ResizeDirection="Rows"/>

                <!-- LUTs -->
                <Border Grid.Row="2">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0" Margin="12,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <TextBlock Text="LUTs" FontSize="13" FontWeight="SemiBold"
                                           Foreground="#F1F1F1" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding Luts.Count, StringFormat=' ({0})'}"
                                           Foreground="#666" FontSize="11" VerticalAlignment="Center"/>
                            </StackPanel>
                            <ToggleButton Grid.Column="1" Content="★" IsChecked="{Binding ShowFavoritesOnly}"
                                          ToolTip="Show favorites only"
                                          Width="24" Height="22" FontSize="12"
                                          Background="#333" Foreground="#888" BorderThickness="0"/>
                        </Grid>

                        <!-- Search Box -->
                        <TextBox Grid.Row="1" Text="{Binding LutSearchQuery, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="12,0,12,8" Padding="6,4"
                                 Background="#1E1E1E" Foreground="#DDD" BorderBrush="#444"
                                 ToolTip="Search LUTs...">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="">
                                            <Setter Property="Background" Value="#1E1E1E"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>

                        <ListBox Grid.Row="2" ItemsSource="{Binding FilteredLuts}"
                                 SelectedItem="{Binding SelectedLut}"
                                 Background="Transparent" BorderThickness="0">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Button Grid.Column="0" Content="★"
                                                Command="{Binding DataContext.ToggleLutFavoriteCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                CommandParameter="{Binding}"
                                                Width="20" Height="18" FontSize="10"
                                                Background="Transparent" BorderThickness="0"
                                                Foreground="{Binding IsFavorite, Converter={StaticResource BoolToFavoriteColorConverter}}"
                                                ToolTip="Toggle favorite"/>
                                        <TextBlock Grid.Column="1" Text="{Binding Name}" Foreground="#AAA" FontSize="11"
                                                   Padding="4,4" ToolTip="{Binding Path}"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="8,4,8,8">
                            <Button Content="Load..." Command="{Binding LoadLutCommand}"
                                    Style="{StaticResource SecondaryButton}" Width="60" Margin="0,0,4,0"/>
                            <Button Content="Clear" Command="{Binding ClearLutCommand}"
                                    Style="{StaticResource SecondaryButton}" Width="50"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Center: Video Preview -->
        <Border Grid.Row="1" Grid.Column="1" Background="#1E1E1E" Margin="5,10,5,5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Preview Area -->
                <Grid Grid.Row="0">
                    <!-- Video Player -->
                    <controls:VideoPlayerControl x:Name="PreviewPlayer"
                                                 Visibility="{Binding HasSource, Converter={StaticResource BoolToVisibilityConverter}}"/>

                    <!-- No source placeholder -->
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                Visibility="{Binding HasSource, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="&#xE714;" FontFamily="Segoe MDL2 Assets" FontSize="48"
                                   Foreground="#444" HorizontalAlignment="Center"/>
                        <TextBlock Text="No clip loaded" FontSize="14" Foreground="#666"
                                   HorizontalAlignment="Center" Margin="0,12,0,4"/>
                        <TextBlock Text="Load a source video to begin color grading" FontSize="11"
                                   Foreground="#555" HorizontalAlignment="Center"/>
                        <Button Content="Load Source Video" Command="{Binding LoadSourceCommand}"
                                Style="{StaticResource SecondaryButton}" Margin="0,20,0,0"/>
                    </StackPanel>

                    <!-- Compare mode overlay -->
                    <Border Background="#CC1E1E1E" Visibility="{Binding IsCompareMode, Converter={StaticResource BoolToVisibilityConverter}}"
                            HorizontalAlignment="Left" VerticalAlignment="Top" Margin="10" Padding="10,8" CornerRadius="4">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="A/B COMPARE" Foreground="#FFA500" FontSize="11" FontWeight="Bold"/>
                                <TextBlock Text=" (Press C to toggle)" Foreground="#888" FontSize="10" VerticalAlignment="Center"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <RadioButton Content="Side by Side" GroupName="CompareMode"
                                             IsChecked="{Binding CompareMode, Converter={StaticResource EnumBoolConverter}, ConverterParameter=SideBySide}"
                                             Foreground="#AAA" FontSize="10" Margin="0,0,12,0"/>
                                <RadioButton Content="Vertical Split" GroupName="CompareMode"
                                             IsChecked="{Binding CompareMode, Converter={StaticResource EnumBoolConverter}, ConverterParameter=VerticalSplit}"
                                             Foreground="#AAA" FontSize="10" Margin="0,0,12,0"/>
                                <RadioButton Content="Wipe" GroupName="CompareMode"
                                             IsChecked="{Binding CompareMode, Converter={StaticResource EnumBoolConverter}, ConverterParameter=Wipe}"
                                             Foreground="#AAA" FontSize="10"/>
                            </StackPanel>
                            <Grid Margin="0,8,0,0" Visibility="{Binding CompareMode, Converter={StaticResource WipeVisibilityConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Original" Foreground="#888" FontSize="9"/>
                                <Slider Grid.Column="1" Minimum="0" Maximum="1" Value="{Binding ComparePosition}"
                                        Margin="8,0" Width="120"/>
                                <TextBlock Grid.Column="2" Text="Graded" Foreground="#888" FontSize="9"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- LUT Intensity Slider (when LUT is applied) -->
                <Border Grid.Row="1" Background="#2A2A2A" Padding="15,10"
                        Visibility="{Binding CurrentGrade.LutPath, Converter={StaticResource StringToVisibilityConverter}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="50"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="LUT Intensity" Foreground="#AAA"
                                   VerticalAlignment="Center" FontSize="11"/>
                        <Slider Grid.Column="1" Minimum="0" Maximum="1"
                                Value="{Binding CurrentGrade.LutIntensity}" Margin="10,0"/>
                        <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.LutIntensity, StringFormat='{}{0:P0}'}"
                                   Foreground="#888" VerticalAlignment="Center" FontSize="11" HorizontalAlignment="Right"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Right Panel: Scopes -->
        <Border Grid.Row="1" Grid.Column="2" Background="#252526" Margin="5,10,10,5"
                Visibility="{Binding ShowScopes, Converter={StaticResource BoolToVisibilityConverter}}">
            <controls:ScopesControl x:Name="ScopesDisplay"/>
        </Border>

        <!-- Bottom: Color Wheels & Adjustments -->
        <Border Grid.Row="2" Grid.ColumnSpan="3" Background="#252526" Margin="10,5,10,10">
            <Grid Margin="15,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Lift Wheel -->
                <controls:ColorWheelControl Grid.Column="0" Title="Lift"
                    ColorX="{Binding CurrentGrade.LiftX, Mode=TwoWay}"
                    ColorY="{Binding CurrentGrade.LiftY, Mode=TwoWay}"
                    Master="{Binding CurrentGrade.LiftMaster, Mode=TwoWay}"
                    Margin="10,0"/>

                <!-- Gamma Wheel -->
                <controls:ColorWheelControl Grid.Column="1" Title="Gamma"
                    ColorX="{Binding CurrentGrade.GammaX, Mode=TwoWay}"
                    ColorY="{Binding CurrentGrade.GammaY, Mode=TwoWay}"
                    Master="{Binding CurrentGrade.GammaMaster, Mode=TwoWay}"
                    Margin="10,0"/>

                <!-- Gain Wheel -->
                <controls:ColorWheelControl Grid.Column="2" Title="Gain"
                    ColorX="{Binding CurrentGrade.GainX, Mode=TwoWay}"
                    ColorY="{Binding CurrentGrade.GainY, Mode=TwoWay}"
                    Master="{Binding CurrentGrade.GainMaster, Mode=TwoWay}"
                    Margin="10,0"/>

                <!-- Curves Panel -->
                <Border Grid.Column="3" Background="#1E1E1E" CornerRadius="4" Padding="10"
                        Margin="20,0,0,0" MinWidth="220"
                        Visibility="{Binding ShowCurves, Converter={StaticResource BoolToVisibilityConverter}}">
                    <controls:CurvesControl x:Name="CurvesEditor"/>
                </Border>

                <!-- Adjustments Panel -->
                <ScrollViewer Grid.Column="4" VerticalScrollBarVisibility="Auto" Margin="20,0,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Left Column -->
                        <StackPanel Grid.Column="0" Margin="0,0,15,0">
                            <TextBlock Text="Basic" Foreground="#AAA" FontWeight="SemiBold"
                                       FontSize="11" Margin="0,0,0,10"/>

                            <!-- Exposure -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Exposure" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-3" Maximum="3" Value="{Binding CurrentGrade.Exposure}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Exposure, StringFormat='{}{0:F2}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Contrast -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Contrast" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Contrast}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Contrast, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Saturation -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Saturation" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Saturation}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Saturation, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Vibrance -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Vibrance" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Vibrance}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Vibrance, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <TextBlock Text="White Balance" Foreground="#AAA" FontWeight="SemiBold"
                                       FontSize="11" Margin="0,15,0,10"/>

                            <!-- Temperature -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Temperature" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Temperature}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Temperature, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Tint -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Tint" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Tint}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Tint, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>

                        <!-- Right Column -->
                        <StackPanel Grid.Column="1" Margin="15,0,0,0">
                            <TextBlock Text="Tone" Foreground="#AAA" FontWeight="SemiBold"
                                       FontSize="11" Margin="0,0,0,10"/>

                            <!-- Highlights -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Highlights" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Highlights}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Highlights, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Shadows -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Shadows" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Shadows}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Shadows, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Whites -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Whites" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Whites}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Whites, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Blacks -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Blacks" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Blacks}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Blacks, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>

                            <TextBlock Text="Detail" Foreground="#AAA" FontWeight="SemiBold"
                                       FontSize="11" Margin="0,15,0,10"/>

                            <!-- Clarity -->
                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="75"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Clarity" Foreground="#888" FontSize="11" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="-100" Maximum="100" Value="{Binding CurrentGrade.Clarity}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding CurrentGrade.Clarity, StringFormat='{}{0:F0}'}"
                                           Foreground="#666" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="2" Grid.ColumnSpan="3" VerticalAlignment="Bottom"
                Background="#2D2D30" Height="24" Margin="10,0,10,10">
            <TextBlock Text="{Binding StatusText}" Foreground="#888" FontSize="11"
                       VerticalAlignment="Center" Margin="10,0"/>
        </Border>
    </Grid>
</UserControl>
